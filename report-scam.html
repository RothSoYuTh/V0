<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Report a Scam - ScamShield</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');

    
    .form-input:focus {
      border-color: #4f46e5;
      box-shadow: 0 0 0 3px rgba(79, 70, 229, 0.1);
    }
    
    .upload-area {
      transition: all 0.3s ease;
      background: linear-gradient(to right, #f8fafc, #ffffff);
      border-color: #e2e8f0;
    }
    
    .upload-area:hover {
      background: linear-gradient(to right, #f1f5f9, #f8fafc);
      border-color: #c7d2fe;
    }
    
    .upload-area.dragover {
      background: linear-gradient(to right, #e0e7ff, #c7d2fe);
      border-color: #4f46e5;
    }
    
    .submit-btn {
      background: linear-gradient(135deg, #4f46e5 0%, #4338ca 100%);
      transition: all 0.3s ease;
    }
    
    .submit-btn:hover {
      background: linear-gradient(135deg, #4338ca 0%, #3730a3 100%);
      transform: translateY(-1px);
      box-shadow: 0 10px 20px -5px rgba(79, 70, 229, 0.3);
    }
    
    .nav-link.active {
      color: #4f46e5;
    }
    
    .info-box {
      background: linear-gradient(135deg, #e0e7ff 0%, #c7d2fe 100%);
      border-color: #4f46e5;
    }
    
    .file-item {
      background: linear-gradient(to right, #f8fafc, #ffffff);
      border-color: #e2e8f0;
    }
    
    .file-item:hover {
      background: linear-gradient(to right, #f1f5f9, #f8fafc);
      transform: translateX(2px);
    }
    
    .header-bg {
      background: linear-gradient(135deg, #ffffff 0%, #f8fafc 100%);
      border-bottom-color: #e2e8f0;
    }
    
    .page-header-bg {
      background: linear-gradient(135deg, #e0e7ff 0%, #c7d2fe 100%);
    }
    
    /* Success modal styles */
    .success-modal {
      position: fixed;
      inset: 0;
      background: rgba(0, 0, 0, 0.5);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 1000;
      opacity: 0;
      visibility: hidden;
      transition: all 0.3s ease;
    }
    
    .success-modal.show {
      opacity: 1;
      visibility: visible;
    }
    
    .success-modal-content {
      background: white;
      border-radius: 1.5rem;
      padding: 2rem;
      max-width: 28rem;
      width: 90%;
      transform: translateY(20px);
      transition: transform 0.3s ease;
    }
    
    .success-modal.show .success-modal-content {
      transform: translateY(0);
    }
    
    .success-icon {
      width: 5rem;
      height: 5rem;
      background: linear-gradient(135deg, #10b981, #059669);
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      margin: 0 auto 1.5rem;
    }
    
    .success-icon i {
      font-size: 2rem;
      color: white;
    }
    
    .file-preview-container {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(80px, 1fr));
      gap: 0.5rem;
      margin: 1rem 0;
    }
    
    .file-preview {
      width: 80px;
      height: 80px;
      object-fit: cover;
      border-radius: 0.5rem;
      border: 2px solid #e2e8f0;
    }
  </style>
</head>
<body class="bg-gradient-to-br from-gray-50 to-indigo-50 min-h-screen">
  <!-- Header -->
  <header class="bg-white shadow-sm sticky top-0 z-50">
    <div class="max-w-6xl mx-auto px-4 py-3 flex items-center justify-between">
      <div class="flex items-center gap-2">
        <div class="w-10 h-10  flex items-center justify-center">
          <img src="logo1.png" alt="">
        </div>
        <div>
          <span class="font-bold text-gray-800">ScamShield</span>
          <p class="text-xs text-gray-500">Protect your purchase</p>
        </div>
      </div>
      <nav class="hidden md:flex items-center gap-6 text-sm">
        <a href="home.html" class="text-gray-600 hover:text-blue-600 font-medium">Home</a>
        <a href="report-scam.html" class="text-blue-600 font-medium border-b-2 border-blue-600 pb-1">Report Scam</a>
        <a href="reports.html" class="text-gray-600 hover:text-blue-600 font-medium">Reports</a>
        <a href="check-seller.html" class="text-gray-600 hover:text-blue-600 font-medium">Check Seller</a>
        <a href="analyze-chat.html" class="text-gray-600 hover:text-blue-600 font-medium">Analyze Chat</a>
        <a href="learn.html" class="text-gray-600 hover:text-blue-600 font-medium">Learn</a>
        <a href="profile.html"><i class="fa-regular fa-user"></i></a>
      </nav>
      <button class="md:hidden text-gray-600" onclick="toggleMobileMenu()">
        <i class="fas fa-bars text-xl"></i>
      </button>
    </div>
    <div id="mobileMenu" class="hidden md:hidden bg-white border-t px-4 py-3">
      <nav class="flex flex-col gap-3 text-sm">
        <a href="home.html" class="text-gray-600">Home</a>
        <a href="report-scam.html" class="text-blue-600 font-medium border-l-4 border-blue-600 pl-3">Report Scam</a>
        <a href="reports.html" class="text-gray-600">Reports</a>
        <a href="check-seller.html" class="text-gray-600">Check Seller</a>
        <a href="analyze-chat.html" class="text-gray-600">Analyze Chat</a>
        <a href="learn.html" class="text-gray-600">Learn</a>
        <a href="profile.html"><i class="fa-regular fa-user"></i></a>
      </nav>
    </div>
  </header>

  <main class="max-w-2xl mx-auto px-4 py-8">
    <!-- Page Header -->
    <div class="flex items-center gap-4 mb-8">
      <div class="w-14 h-14 page-header-bg rounded-xl flex items-center justify-center shadow-sm">
        <i class="fas fa-file-alt text-indigo-600 text-2xl"></i>
      </div>
      <div>
        <h1 class="text-2xl font-bold text-gray-900">Report a Scam</h1>
        <p class="text-gray-600 text-sm">Help protect others by sharing your experience</p>
      </div>
    </div>

    <!-- Form -->
    <form id="scamReportForm" class="space-y-6">
      <div class="grid md:grid-cols-2 gap-4">
        <div>
          <label class="block text-sm font-medium text-gray-800 mb-2">Seller's name or username*</label>
          <input type="text" id="sellerName" placeholder="Enter seller's name or username" required
            class="form-input w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none text-sm bg-white">
        </div>
        <div>
          <label class="block text-sm font-medium text-gray-800 mb-2">Phone number*</label>
          <input type="tel" id="phoneNumber" placeholder="+855 12 357 829" required
            class="form-input w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none text-sm bg-white">
        </div>
      </div>

      <div class="grid md:grid-cols-2 gap-4">
        <div>
          <label class="block text-sm font-medium text-gray-800 mb-2">Platform*</label>
          <select id="platform" required
            class="form-input w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none text-sm bg-white text-gray-700 appearance-none">
            <option value="" class="text-gray-400">Select platform</option>
            <option value="facebook" class="text-gray-700">Facebook</option>
            <option value="telegram" class="text-gray-700">Telegram</option>
            <option value="instagram" class="text-gray-700">Instagram</option>
            <option value="tiktok" class="text-gray-700">TikTok</option>
            <option value="other" class="text-gray-700">Other</option>
          </select>
        </div>
        <div>
          <label class="block text-sm font-medium text-gray-800 mb-2">Platform link/Profile URL*</label>
          <input type="url" id="profileUrl" placeholder="https://facebook.com" required
            class="form-input w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none text-sm bg-white">
        </div>
      </div>

      <div>
        <label class="block text-sm font-medium text-gray-800 mb-2">Incident Description*</label>
        <textarea id="description" rows="4" placeholder="Describe what happen, you were scammed, lost amount, scammed process..." required
          class="form-input w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none text-sm bg-white resize-none"></textarea>
      </div>

      <div>
        <label class="block text-sm font-medium text-gray-800 mb-2">Upload Screenshot of evidences*</label>
        <div id="uploadArea" class="upload-area border-2 border-dashed rounded-lg p-8 text-center cursor-pointer">
          <input type="file" id="fileInput" accept="image/*" multiple class="hidden">
          <i class="fas fa-cloud-upload-alt text-gray-500 text-3xl mb-3"></i>
          <p class="text-gray-700 text-sm">Click here to upload image</p>
          <p class="text-gray-500 text-xs mt-1">jpeg,png, up to 5MB</p>
        </div>
        <div id="fileList" class="mt-3 space-y-2"></div>
      </div>

      <div class="info-box rounded-lg p-4 border-l-4">
        <p class="text-indigo-800 text-sm">
          <i class="fas fa-info-circle mr-2"></i>
          Your report will be stored locally in your browser and shared with the community. Please ensure all information is accurate.
        </p>
      </div>

      <button type="submit" class="submit-btn text-white py-4 rounded-lg font-medium w-full shadow-md">
        <span id="submitText">Submit Report</span>
        <span id="submitSpinner" class="hidden"><i class="fas fa-spinner fa-spin mr-2"></i>Processing...</span>
      </button>
    </form>
  </main>

  <!-- Success Modal (Custom built-in modal) - UPDATED -->
  <div id="successModal" class="success-modal">
    <div class="success-modal-content">
      <div class="success-icon">
        <i class="fas fa-check"></i>
      </div>
      <h2 class="text-xl font-bold text-gray-900 text-center mb-2">Report Submitted Successfully!</h2>
      <p class="text-gray-600 text-center mb-4">
        Your report has been saved and will help protect others in the community.
      </p>
      
      <div class="bg-gray-50 rounded-lg p-4 mb-4">
        <div class="flex items-center justify-between mb-2">
          <span class="text-sm font-medium text-gray-700">Report Summary:</span>
          <span class="text-xs bg-indigo-100 text-indigo-800 px-2 py-1 rounded-full" id="imageCountBadge">0 images</span>
        </div>
        <p class="text-sm text-gray-600"><strong>Seller:</strong> <span id="modalSellerName">-</span></p>
        <p class="text-sm text-gray-600"><strong>Platform:</strong> <span id="modalPlatform">-</span></p>
        
        <div id="modalImagePreview" class="file-preview-container mt-3"></div>
      </div>
      
      <!-- SOLUTION 2: Single Close Button -->
      <div class="text-center">
        <button onclick="closeSuccessModal()" class="bg-indigo-600 text-white px-6 py-3 rounded-lg font-medium text-sm hover:bg-indigo-700 transition w-full">
          <i class="fas fa-check mr-2"></i>Done
        </button>
        <p class="text-xs text-gray-500 mt-2">Click anywhere outside or press ESC to close</p>
      </div>
    </div>
  </div>

  <!-- Error Modal - UPDATED -->
  <div id="errorModal" class="success-modal">
    <div class="success-modal-content">
      <div class="success-icon" style="background: linear-gradient(135deg, #ef4444, #dc2626);">
        <i class="fas fa-exclamation-triangle"></i>
      </div>
      <h2 class="text-xl font-bold text-gray-900 text-center mb-2">Submission Failed</h2>
      <p id="errorMessage" class="text-gray-600 text-center mb-4">
        There was an error submitting your report.
      </p>
      <div class="text-center">
        <button onclick="closeErrorModal()" class="bg-indigo-600 text-white px-6 py-3 rounded-lg font-medium text-sm hover:bg-indigo-700 transition w-full">
          Try Again
        </button>
      </div>
    </div>
  </div>

  <!-- Footer -->
  <footer class="bg-gradient-to-b from-gray-900 to-black text-white border-t border-gray-800 mt-16">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-12">
      <div class="flex flex-col md:flex-row items-center justify-between gap-8">
        <div class="text-center md:text-left">
          <div class="flex items-center gap-3 justify-center md:justify-start mb-4">
            <div class="w-10 h-10 bg-gradient-to-br from-indigo-500 to-purple-500 rounded-full flex items-center justify-center shadow-md">
              <i class="fas fa-shield-alt"></i>
            </div>
            <span class="font-bold text-xl bg-gradient-to-r from-white to-gray-300 bg-clip-text text-transparent">ScamShield</span>
          </div>
          <p class="text-gray-400 text-sm max-w-md">Protecting the community from online scams through collective awareness and reporting.</p>
        </div>
        
        <div class="text-center md:text-right">
          <p class="text-gray-300 text-sm mb-2">Â© 2025 ScamShield - Online Selling Scam Report Platform</p>
          <p class="text-gray-400 text-xs mb-1">Developed by Sorayuth Roth & Srongchhay Ly</p>
          <p class="text-gray-500 text-xs mb-3">Cambodia Academy of Digital Technology (CADT)</p>
          <p class="text-gray-500 text-xs">Data stored locally in your browser. Your privacy is protected.</p>
        </div>
      </div>
    </div>
  </footer>

  <script>
    function toggleMobileMenu() {
      const menu = document.getElementById('mobileMenu');
      menu.classList.toggle('hidden');
    }

    // File upload handling
    const uploadArea = document.getElementById('uploadArea');
    const fileInput = document.getElementById('fileInput');
    const fileList = document.getElementById('fileList');
    let uploadedFiles = [];

    uploadArea.addEventListener('click', () => fileInput.click());
    
    uploadArea.addEventListener('dragover', (e) => {
      e.preventDefault();
      uploadArea.classList.add('dragover');
    });
    
    uploadArea.addEventListener('dragleave', () => {
      uploadArea.classList.remove('dragover');
    });
    
    uploadArea.addEventListener('drop', (e) => {
      e.preventDefault();
      uploadArea.classList.remove('dragover');
      handleFiles(e.dataTransfer.files);
    });

    fileInput.addEventListener('change', (e) => handleFiles(e.target.files));

    function handleFiles(files) {
      for (let file of files) {
        if (file.size <= 5 * 1024 * 1024) {
          uploadedFiles.push(file);
          displayFile(file);
        } else {
          showErrorModal('File too large. Maximum size is 5MB.');
        }
      }
    }

    function displayFile(file) {
      const div = document.createElement('div');
      div.className = 'file-item rounded-lg p-3 flex items-center justify-between border';
      div.innerHTML = `
        <div class="flex items-center gap-3">
          <i class="fas fa-image text-indigo-500"></i>
          <span class="text-sm text-gray-800 truncate max-w-xs">${file.name}</span>
          <span class="text-xs text-gray-500">(${(file.size / 1024).toFixed(1)} KB)</span>
        </div>
        <button type="button" class="text-red-500 hover:text-red-700" onclick="removeFile(this, '${file.name}')">
          <i class="fas fa-times"></i>
        </button>
      `;
      fileList.appendChild(div);
    }

    function removeFile(button, fileName) {
      uploadedFiles = uploadedFiles.filter(file => file.name !== fileName);
      button.parentElement.remove();
    }

    // Modal functions
    function showSuccessModal(report, screenshots) {
      // Update modal content
      document.getElementById('modalSellerName').textContent = report.sellerName || 'Unknown';
      document.getElementById('modalPlatform').textContent = report.platform || 'Unknown';
      document.getElementById('imageCountBadge').textContent = screenshots.length + ' image' + (screenshots.length !== 1 ? 's' : '');
      
      // Show image previews
      const previewContainer = document.getElementById('modalImagePreview');
      previewContainer.innerHTML = '';
      
      if (screenshots.length > 0) {
        screenshots.slice(0, 4).forEach((screenshot, index) => {
          const img = document.createElement('img');
          img.src = screenshot;
          img.alt = `Evidence ${index + 1}`;
          img.className = 'file-preview';
          previewContainer.appendChild(img);
        });
        
        if (screenshots.length > 4) {
          const more = document.createElement('div');
          more.className = 'w-20 h-20 bg-gray-200 rounded-lg flex items-center justify-center text-gray-600 text-sm';
          more.textContent = `+${screenshots.length - 4}`;
          previewContainer.appendChild(more);
        }
      }
      
      // Show modal
      document.getElementById('successModal').classList.add('show');
    }

    // SOLUTION 2: Close button function
    function closeSuccessModal() {
      document.getElementById('successModal').classList.remove('show');
      // Reset form after closing
      resetForm();
    }

    function showErrorModal(message) {
      document.getElementById('errorMessage').textContent = message;
      document.getElementById('errorModal').classList.add('show');
    }

    function closeErrorModal() {
      document.getElementById('errorModal').classList.remove('show');
    }

    // Helper function to reset form
    function resetForm() {
      document.getElementById('scamReportForm').reset();
      uploadedFiles = [];
      fileList.innerHTML = '';
      
      // Reset button state
      const submitBtn = document.querySelector('.submit-btn');
      submitBtn.disabled = false;
      document.getElementById('submitText').classList.remove('hidden');
      document.getElementById('submitSpinner').classList.add('hidden');
      
      // Scroll to top (optional)
      window.scrollTo({ top: 0, behavior: 'smooth' });
    }

    // Form submission
    document.getElementById('scamReportForm').addEventListener('submit', async (e) => {
      e.preventDefault();
      
      // Show loading state
      const submitBtn = document.querySelector('.submit-btn');
      submitBtn.disabled = true;
      document.getElementById('submitText').classList.add('hidden');
      document.getElementById('submitSpinner').classList.remove('hidden');
      
      try {
        // Convert uploaded files to Base64
        const screenshots = [];
        
        for (let file of uploadedFiles) {
          const base64 = await new Promise((resolve, reject) => {
            const reader = new FileReader();
            reader.onload = () => resolve(reader.result);
            reader.onerror = reject;
            reader.readAsDataURL(file);
          });
          screenshots.push(base64);
        }
        
        const report = {
          id: Date.now(),
          sellerName: document.getElementById('sellerName').value,
          phoneNumber: document.getElementById('phoneNumber').value,
          platform: document.getElementById('platform').value,
          profileUrl: document.getElementById('profileUrl').value,
          description: document.getElementById('description').value,
          screenshots: screenshots,
          date: new Date().toISOString()
        };

        // Store in localStorage
        const reports = JSON.parse(localStorage.getItem('scamReports') || '[]');
        reports.push(report);
        localStorage.setItem('scamReports', JSON.stringify(reports));

        // Show success modal
        showSuccessModal(report, screenshots);
        
      } catch (error) {
        console.error('Error:', error);
        showErrorModal(error.message.includes('FileReader') 
          ? 'Error processing images. Please try again with smaller files.' 
          : 'Error: ' + error.message);
          
        // Reset button state
        submitBtn.disabled = false;
        document.getElementById('submitText').classList.remove('hidden');
        document.getElementById('submitSpinner').classList.add('hidden');
      }
    });

    // SOLUTION 3: Click anywhere outside to close
    document.addEventListener('click', (e) => {
      const successModal = document.getElementById('successModal');
      const errorModal = document.getElementById('errorModal');
      
      // Click outside success modal
      if (e.target === successModal) {
        closeSuccessModal();
      }
      
      // Click outside error modal
      if (e.target === errorModal) {
        closeErrorModal();
      }
    });

    // Close modals with ESC key
    document.addEventListener('keydown', (e) => {
      if (e.key === 'Escape') {
        if (document.getElementById('successModal').classList.contains('show')) {
          closeSuccessModal();
        }
        if (document.getElementById('errorModal').classList.contains('show')) {
          closeErrorModal();
        }
      }
    });
    
  </script>
</body>
</html>